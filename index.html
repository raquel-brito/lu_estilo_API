<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Lu Estilo API - Apresentação</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .hero {
      background: linear-gradient(90deg, #f8fafc 60%, #e0e7ef 100%);
      padding: 3rem 0 2rem 0;
    }
    .feature-icon {
      font-size: 2.5rem;
      color: #0d6efd;
    }
    .section-title {
      border-left: 5px solid #0d6efd;
      padding-left: 0.5rem;
      margin-bottom: 1.5rem;
    }
    .card {
      min-height: 100%;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">Lu Estilo API</a>
      <span class="navbar-text">Desafio Técnico Back-End</span>
    </div>
  </nav>

  <section class="hero text-center">
    <div class="container">
      <h1 class="display-5 fw-bold mb-3">API RESTful para Gestão Comercial</h1>
      <p class="lead mb-4">Plataforma robusta para gerenciamento de clientes, produtos, pedidos e integração automática com WhatsApp.</p>
      <a href="http://localhost:8000/docs" class="btn btn-primary btn-lg" target="_blank">Ver Documentação Swagger</a>
    </div>
  </section>

  <section class="container my-5">
    <h2 class="section-title">Principais Funcionalidades</h2>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="feature-icon mb-3"><i class="bi bi-shield-lock"></i></div>
            <h5 class="card-title">Autenticação JWT</h5>
            <p class="card-text">Login seguro, registro de usuários, refresh token e níveis de acesso (admin e usuário comum).</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="feature-icon mb-3"><i class="bi bi-people"></i></div>
            <h5 class="card-title">Gestão de Clientes</h5>
            <p class="card-text">CRUD completo, validação de email e CPF únicos, filtros e paginação.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="feature-icon mb-3"><i class="bi bi-box-seam"></i></div>
            <h5 class="card-title">Gestão de Produtos</h5>
            <p class="card-text">CRUD completo, filtros por categoria, preço, disponibilidade, imagens e controle de estoque.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="feature-icon mb-3"><i class="bi bi-cart-check"></i></div>
            <h5 class="card-title">Gestão de Pedidos</h5>
            <p class="card-text">Pedidos com múltiplos produtos, validação de estoque, filtros avançados e atualização de status.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="feature-icon mb-3"><i class="bi bi-whatsapp"></i></div>
            <h5 class="card-title">Integração WhatsApp</h5>
            <p class="card-text">Envio automático de mensagens para clientes em eventos como novos pedidos, orçamentos e promoções.</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="feature-icon mb-3"><i class="bi bi-gear"></i></div>
            <h5 class="card-title">Pronto para Produção</h5>
            <p class="card-text">Deploy com Docker, monitoramento de erros via Sentry, migrações Alembic, testes automatizados e documentação Swagger.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="container my-5">
    <h2 class="section-title">Tecnologias Utilizadas</h2>
    <ul class="list-group list-group-flush">
      <li class="list-group-item"><b>Python</b> &nbsp;|&nbsp; <b>FastAPI</b> &nbsp;|&nbsp; <b>PostgreSQL</b> &nbsp;|&nbsp; <b>Docker</b> &nbsp;|&nbsp; <b>Pytest</b> &nbsp;|&nbsp; <b>Sentry</b> &nbsp;|&nbsp; <b>UltraMsg API</b></li>
    </ul>
  </section>

  <!-- Seção interativa para login, cadastro e perfil -->
  <section class="container my-5">
    <h2 class="section-title">Testar API ao Vivo</h2>
    <div class="row">
      <div class="col-md-6">
        <form id="loginForm" class="mb-3">
          <h5>Login</h5>
          <div class="mb-2">
            <input type="email" class="form-control" id="loginEmail" placeholder="E-mail" required>
          </div>
          <div class="mb-2">
            <input type="password" class="form-control" id="loginPassword" placeholder="Senha" required>
          </div>
          <button type="submit" class="btn btn-primary">Entrar</button>
          <button type="button" class="btn btn-link" id="showRegisterBtn">Cadastre-se</button>
          <div id="loginMsg" class="mt-2 text-danger"></div>
        </form>
        <form id="registerForm" class="mb-3" style="display:none;">
          <h5>Cadastro</h5>
          <div class="mb-2">
            <input type="text" class="form-control" id="registerName" placeholder="Nome" required>
          </div>
          <div class="mb-2">
            <input type="email" class="form-control" id="registerEmail" placeholder="E-mail" required>
          </div>
          <div class="mb-2">
            <input type="password" class="form-control" id="registerPassword" placeholder="Senha" required>
          </div>
          <button type="submit" class="btn btn-success">Cadastrar</button>
          <button type="button" class="btn btn-link" id="showLoginBtn">Já tenho conta</button>
          <div id="registerMsg" class="mt-2 text-danger"></div>
        </form>
        <div id="tokenBox" style="display:none;">
          <div class="alert alert-success">
            Token JWT obtido! <br>
            <small id="jwtToken"></small>
          </div>
          <button id="profileBtn" class="btn btn-info">Ver Meu Perfil</button>
        </div>
      </div>
      <div class="col-md-6">
        <h5>Perfil</h5>
        <div id="profileBox" style="display:none;" class="mt-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Meu Perfil</h5>
              <p class="card-text mb-1"><b>Nome:</b> <span id="profileName"></span></p>
              <p class="card-text mb-1"><b>Email:</b> <span id="profileEmail"></span></p>
              <p class="card-text mb-0"><b>Admin:</b> <span id="profileAdmin"></span></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="container my-5">
    <h2 class="section-title">Como Testar</h2>
    <ol>
      <li>Clone o repositório e configure o arquivo <code>.env</code> com base no <code>.env.example</code>.</li>
      <li>Suba os containers com <code>docker compose up --build</code>.</li>
      <li>Acesse a documentação interativa em <a href="http://localhost:8000/docs" target="_blank">/docs</a>.</li>
      <li>Use as rotas de autenticação para gerar um token JWT e acessar os recursos protegidos.</li>
    </ol>
    <p>Consulte o <b>README.md</b> para instruções detalhadas e exemplos de uso.</p>
  </section>

  <footer class="bg-light py-4 mt-5">
    <div class="container text-center">
      <small>Desenvolvido por <a href="https://github.com/raquel-brito" target="_blank">Raquel Brito</a> &middot; 2025</small>
    </div>
  </footer>

  <!-- Bootstrap Icons CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <script>
  let jwt = "";

  // Alternar entre login e cadastro
  document.getElementById('showRegisterBtn').onclick = function() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('registerForm').style.display = 'block';
    document.getElementById('loginMsg').innerText = '';
    document.getElementById('registerMsg').innerText = '';
  };
  document.getElementById('showLoginBtn').onclick = function() {
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('loginMsg').innerText = '';
    document.getElementById('registerMsg').innerText = '';
  };

  // Cadastro
  document.getElementById('registerForm').onsubmit = async function(e) {
    e.preventDefault();
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const data = JSON.stringify({ username: name, email, password });

    try {
      const resp = await fetch('http://localhost:8000/api/v1/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: data
      });
      let json = {};
      try {
        json = await resp.json();
      } catch (err) {
        //
      }
      if (resp.ok) {
        document.getElementById('registerMsg').classList.remove('text-danger');
        document.getElementById('registerMsg').classList.add('text-success');
        document.getElementById('registerMsg').innerText = 'Cadastro realizado! Faça login.';
        setTimeout(() => {
          document.getElementById('registerForm').style.display = 'none';
          document.getElementById('loginForm').style.display = 'block';
          document.getElementById('registerMsg').innerText = '';
        }, 1500);
      } else {
        document.getElementById('registerMsg').classList.remove('text-success');
        document.getElementById('registerMsg').classList.add('text-danger');
        document.getElementById('registerMsg').innerText = json.detail || 'Erro ao cadastrar';
      }
    } catch (error) {
      document.getElementById('registerMsg').classList.remove('text-success');
      document.getElementById('registerMsg').classList.add('text-danger');
      document.getElementById('registerMsg').innerText = 'Erro de conexão com o backend';
    }
  };

  // Login
  document.getElementById('loginForm').onsubmit = async function(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const data = new URLSearchParams();
    data.append('username', email);
    data.append('password', password);

    try {
      const resp = await fetch('http://localhost:8000/api/v1/auth/login', {
        method: 'POST',
        body: data
      });
      let json = {};
      try {
        json = await resp.json();
      } catch (err) {}
      if (resp.ok && json.access_token) {
        jwt = json.access_token;
        document.getElementById('loginMsg').innerText = '';
        document.getElementById('tokenBox').style.display = 'block';
        document.getElementById('jwtToken').innerText = jwt;
        document.getElementById('profileBox').style.display = 'none';
      } else {
        document.getElementById('loginMsg').innerText = json.detail || 'Usuário ou senha inválidos';
        document.getElementById('tokenBox').style.display = 'none';
        document.getElementById('profileBox').style.display = 'none';
      }
    } catch (error) {
      document.getElementById('loginMsg').innerText = 'Erro de conexão com o backend';
      document.getElementById('tokenBox').style.display = 'none';
      document.getElementById('profileBox').style.display = 'none';
    }
  };

  // Ver perfil (mostra sempre na coluna "Perfil")
  document.getElementById('profileBtn').onclick = async function() {
    const box = document.getElementById('profileBox');
    box.style.display = 'none';
    box.innerHTML = `<div class="card"><div class="card-body"><h5 class="card-title">Meu Perfil</h5>
      <p class="card-text mb-1"><b>Nome:</b> <span id="profileName"></span></p>
      <p class="card-text mb-1"><b>Email:</b> <span id="profileEmail"></span></p>
      <p class="card-text mb-0"><b>Admin:</b> <span id="profileAdmin"></span></p>
      </div></div>`;
    try {
      const resp = await fetch('http://localhost:8000/api/v1/auth/me', {
        headers: { 'Authorization': 'Bearer ' + jwt }
      });
      let json = {};
      try {
        json = await resp.json();
      } catch (err) {}
      if (resp.ok && json.email) {
        document.getElementById('profileName').innerText = json.username || json.name || '-';
        document.getElementById('profileEmail').innerText = json.email;
        document.getElementById('profileAdmin').innerText = json.is_admin ? 'Sim' : 'Não';
        box.style.display = 'block';
      } else {
        box.innerHTML = '<div class="alert alert-danger">Erro ao buscar perfil</div>';
        box.style.display = 'block';
      }
    } catch (error) {
      box.innerHTML = '<div class="alert alert-danger">Erro de conexão com o backend</div>';
      box.style.display = 'block';
    }
  };
  </script>
</body>
</html>